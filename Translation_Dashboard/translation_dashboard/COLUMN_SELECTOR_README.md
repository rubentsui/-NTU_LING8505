# 欄位選擇功能說明

## 功能概述

現在當您上傳 Excel 檔案時，系統會顯示一個欄位選擇對話框，讓您可以：

1. **選擇來源文本欄位** - 選擇包含原文（通常是英文）的欄位
2. **選擇參考翻譯欄位** - 選擇包含參考翻譯的欄位（選填）
3. **配置翻譯模型** - 為每個翻譯模型選擇：
   - 翻譯文本欄位
   - 評估指標欄位（BLEU、BLEURT、COMET、COMET-KIWI、TransQuest）

## 使用流程

### 1. 上傳檔案
點擊「上傳檔案」按鈕，選擇您的 Excel 檔案。

### 2. 欄位選擇對話框
上傳後會自動顯示欄位選擇對話框，包含：
- 檔案資訊（檔名、資料筆數）
- 自動偵測的欄位配置
- 每個欄位的範例資料預覽

### 3. 配置欄位

#### 來源文本欄位
- 系統會自動偵測名為 `en`、包含 `source` 或 `english` 的欄位
- 您可以手動更改選擇

#### 參考翻譯欄位（選填）
- 系統會自動偵測包含 `reference` 的欄位
- 如果沒有參考翻譯，可以留空

#### 翻譯模型
系統會自動偵測所有 `zh(...)` 格式的欄位作為翻譯模型：

**自動偵測功能：**
- 模型名稱：從 `zh(模型名)` 中提取
- 翻譯文本：自動選擇對應的 `zh(...)` 欄位
- 評估指標：自動匹配包含模型名稱和指標名稱的欄位

**手動調整：**
- 點擊模型名稱可以編輯
- 展開/收合模型卡片查看詳細配置
- 新增或刪除模型
- 為每個模型選擇評估指標欄位

### 4. 確認並載入
- 檢查所有配置是否正確
- 點擊「確認並載入」按鈕
- 系統會處理檔案並顯示儀表板

## 技術實作

### 前端 (Frontend)

**新增檔案：**
- `src/components/ColumnSelector.tsx` - 欄位選擇對話框組件
- `src/components/ColumnSelector.css` - 對話框樣式

**修改檔案：**
- `src/api.ts` - 新增 `uploadFilePreview` 和 `processUploadedFile` API
- `src/App.tsx` - 整合欄位選擇流程

### 後端 (Backend)

**API 端點：**

1. **POST /api/upload/preview**
   - 上傳檔案並返回欄位資訊
   - 包含欄位列表和範例資料
   - 檔案暫存為臨時檔案

2. **POST /api/upload/process**
   - 根據使用者配置處理檔案
   - 接收欄位映射配置
   - 返回處理後的資料

**請求格式：**
```json
{
  "temp_path": "臨時檔案路徑",
  "source_column": "en",
  "reference_column": "zh_reference",
  "model_columns": [
    {
      "name": "GPT-4",
      "text_column": "zh(GPT-4)",
      "metric_columns": {
        "BLEU": "zh(GPT-4)_sacrebleu",
        "COMET": "zh(GPT-4)_wmt22-comet-da"
      }
    }
  ]
}
```

## 優勢

1. **靈活性** - 支援任意欄位命名格式
2. **易用性** - 自動偵測常見格式，減少手動配置
3. **可視化** - 顯示範例資料，確保選擇正確
4. **可擴展** - 輕鬆新增或移除模型和指標

## 注意事項

- 至少需要配置一個翻譯模型
- 每個模型必須有名稱和翻譯文本欄位
- 評估指標是選填的
- 取消選擇會清除臨時檔案
